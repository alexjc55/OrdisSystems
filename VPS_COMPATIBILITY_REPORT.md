# VPS Compatibility Analysis Report

## üö® –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ —Å Replit –Ω–∞ VPS

### 1. **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞: import.meta.dirname**

**–§–∞–π–ª—ã —Å —Ä–∏—Å–∫–æ–º:**
- `server/vite.ts` (—Å—Ç—Ä–æ–∫–∏ 49, 71)
- `vite.config.ts` (—Å—Ç—Ä–æ–∫–∏ 21-28)

**–ü—Ä–æ–±–ª–µ–º–∞:** `import.meta.dirname` –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –≤ Node.js 20.11+
**–†–∏—Å–∫:** –ù–∞ VPS —Å Node.js 18.x –±—É–¥–µ—Ç `undefined` ‚Üí —Å–ª–æ–º–∞—é—Ç—Å—è –≤—Å–µ –ø—É—Ç–∏

### 2. **–ü—Ä–æ–±–ª–µ–º—ã –ø–æ—Ä—Ç–æ–≤ –∏ —Ö–æ—Å—Ç–∏–Ω–≥–∞**

**–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
```typescript
// server/index.ts
const port = 5000; // –ñ–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–æ –¥–ª—è Replit
server.listen({ port, host: "0.0.0.0" });
```

**VPS –ø—Ä–æ–±–ª–µ–º—ã:**
- –ü–æ—Ä—Ç 5000 –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–Ω—è—Ç
- –ù—É–∂–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ PORT –∏–∑ environment variables
- –¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ reverse proxy (Nginx)

### 3. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è**

**Replit:**
```
/home/runner/workspace/
‚îú‚îÄ‚îÄ uploads/ (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îú‚îÄ‚îÄ client/
‚îú‚îÄ‚îÄ server/
```

**VPS –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏ `uploads/`
- –†–∞–∑–ª–∏—á–Ω—ã–µ –ø—É—Ç–∏ –∫ –ø—Ä–æ–µ–∫—Ç—É
- –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º

### 4. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è**

**Replit:** Neon PostgreSQL (serverless) —Å WebSocket
**VPS:** –û–±—ã—á–Ω—ã–π PostgreSQL –±–µ–∑ WebSocket

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –æ–±—ã—á–Ω—ã–º PostgreSQL
- –†–∞–∑–ª–∏—á–∏—è –≤ —Å—Ç—Ä–æ–∫–∞—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- SSL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ü—É–ª—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

**–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:** –í –ª–æ–≥–∞—Ö VPS –≤–∏–¥–Ω—ã –æ—à–∏–±–∫–∏ WebSocket:
```
Error fetching store settings: ErrorEvent {
  [Symbol(kTarget)]: WebSocket {
    _readyState: 3,  // CLOSED
    _closeCode: 1006  // ABNORMAL_CLOSURE
```

## ‚úÖ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ WebSocket –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**

**–û–±–Ω–æ–≤–ª–µ–Ω** `server/db.ts` —Å —É—Å–ª–æ–≤–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π:
```typescript
// Only configure WebSocket for Neon Database (Replit environment)
// On VPS with regular PostgreSQL, this should be disabled
if (process.env.USE_NEON === "true") {
  neonConfig.webSocketConstructor = ws;
}
```

**–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
- `.env`: `USE_NEON=false` (–¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è)
- `.env.vps`: –®–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è VPS
- `.env.example`: –û–±–Ω–æ–≤–ª–µ–Ω —Å –Ω–æ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π

### 2. **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∑–∞–º–µ–Ω–∞ –¥–ª—è import.meta.dirname**

–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `server/path-utils.ts` —Å fallback —Ñ—É–Ω–∫—Ü–∏—è–º–∏:
```typescript
export function getCurrentDir(importMetaUrl: string): string {
  // Node.js 20.11+ support
  if (import.meta.dirname) return import.meta.dirname;
  
  // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π
  return path.dirname(fileURLToPath(importMetaUrl));
}
```

### 2. **VPS-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π vite.config.ts**

–°–æ–∑–¥–∞–Ω `vite.config.vps.ts` —Å:
- Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π Node.js
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø—É—Ç–µ–π
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### 3. **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è**

**–ü–µ—Ä–µ–¥ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ–º –Ω–∞ VPS:**

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é Node.js:**
   ```bash
   node --version  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å >= 20.11
   ```

2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è VPS:**
   ```bash
   # –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å .env.vps –≤ .env
   cp .env.vps .env
   
   # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:
   USE_NEON=false
   DATABASE_URL=postgresql://user:password@localhost:5432/database
   PORT=3000
   NODE_ENV=production
   ```

3. **–î–ª—è Replit —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:**
   ```bash
   USE_NEON=true
   DATABASE_URL=postgresql://neondb_owner:...@ep-....neon.tech/neondb?sslmode=require
   ```

4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Nginx reverse proxy:**
   ```nginx
   location / {
     proxy_pass http://localhost:3000;
     proxy_set_header Host $host;
   }
   ```

## üîß –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã –Ω–∞ VPS, –∑–∞–º–µ–Ω–∏—Ç–µ –≤ `server/vite.ts`:

```typescript
// –í–º–µ—Å—Ç–æ:
import.meta.dirname

// –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
path.dirname(fileURLToPath(import.meta.url))
```

## üìã –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è VPS —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

- [ ] Node.js –≤–µ—Ä—Å–∏—è >= 20.11
- [ ] PostgreSQL –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] –ü—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏ uploads/
- [ ] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] Nginx/Apache –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–∞–∫ reverse proxy
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –ø—É—Ç–µ–π –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π PWA
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç–∏

**–í—ã–≤–æ–¥:** –û—Å–Ω–æ–≤–Ω–∞—è —É–≥—Ä–æ–∑–∞ - `import.meta.dirname` –Ω–∞ —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏—è—Ö Node.js. –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–∞—é—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π VPS.