# Инструкции по откату версии

## Информация о точке отката
- **Дата создания**: 18 июня 2025, 18:48 UTC
- **Файл резервной копии**: `rollback_20250618_184817.sql`
- **Описание состояния**: Версия с добавленными полями для HTML/JS кода отслеживания и структурированными настройками магазина

## Что включено в эту версию:
1. Поля `headerHtml` и `footerHtml` в таблице `store_settings`
2. Компонент `CustomHtml` для безопасного внедрения кода
3. Структурированные настройки магазина в админ панели
4. Исправленная фильтрация пользователей по ролям
5. Поддержка Facebook Pixel, Google Analytics и других счетчиков

## Восстановление из резервной копии:

### Шаг 1: Восстановление базы данных
```bash
psql $DATABASE_URL < rollback_20250618_184817.sql
```

### Шаг 2: Перезапуск приложения
```bash
npm run dev
```

### Шаг 3: Проверка работоспособности
1. Проверьте подключение к базе данных
2. Убедитесь, что все таблицы восстановлены
3. Проверьте работу админ панели
4. Протестируйте настройки магазина

## Структура базы данных в этой версии:

### Таблица store_settings (новые поля):
- `header_html` - HTML/JS код для вставки в <head>
- `footer_html` - HTML/JS код для вставки перед </body>

### Таблица users:
- Поддержка ролей: admin, worker, customer
- Исправленная фильтрация по ролям

## Возможные проблемы и решения:

### Проблема: Ошибка внешнего ключа при запуске
**Решение**: Это известная проблема с seed данными, не влияет на работу приложения

### Проблема: Не работают настройки HTML/JS кода
**Решение**: Убедитесь, что поля `headerHtml` и `footerHtml` существуют в таблице store_settings

### Проблема: Не отображаются секции в настройках магазина
**Решение**: Проверьте, что файл `client/src/pages/admin-dashboard.tsx` содержит структурированные секции

## Контакты для поддержки:
При возникновении проблем с откатом обратитесь к разработчику системы.