<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 50px auto; 
            padding: 20px;
            background: #f5f5f5;
        }
        .container { 
            background: white; 
            padding: 30px; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 10px 5px;
        }
        button:hover { background: #0056b3; }
        .status { 
            background: #e9ecef; 
            padding: 15px; 
            border-radius: 5px; 
            margin: 15px 0; 
            font-family: monospace;
        }
        .log { 
            background: #f8f9fa; 
            border: 1px solid #dee2e6; 
            padding: 15px; 
            border-radius: 5px; 
            margin: 15px 0; 
            height: 300px; 
            overflow-y: auto; 
            font-family: monospace; 
            font-size: 12px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîÑ –¢–µ—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</h1>
        
        <div class="status">
            <strong>–¢–µ–∫—É—â–∏–π —Ö–µ—à:</strong> <span id="currentHash">–ó–∞–≥—Ä—É–∑–∫–∞...</span><br>
            <strong>–ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞:</strong> <span id="lastCheck">-</span><br>
            <strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="status">–û–∂–∏–¥–∞–Ω–∏–µ</span>
        </div>
        
        <button onclick="triggerUpdate()">üß™ –°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</button>
        <button onclick="checkCurrentHash()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Ö–µ—à</button>
        <button onclick="clearLogs()">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
        
        <h3>üìã –õ–æ–≥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:</h3>
        <div id="logs" class="log"></div>
        
        <h3>‚ÑπÔ∏è –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:</h3>
        <ol>
            <li>–û—Ç–∫—Ä–æ–π—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –¥—Ä—É–≥–æ–π –≤–∫–ª–∞–¥–∫–µ</li>
            <li>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ" –Ω–∏–∂–µ</li>
            <li>–ù–∞–±–ª—é–¥–∞–π—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ - —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</li>
            <li>–û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</li>
        </ol>
    </div>

    <script>
        let currentAppHash = '';
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.getElementById('logs');
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : '';
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        async function checkCurrentHash() {
            try {
                const response = await fetch('/api/version?' + Date.now());
                const data = await response.json();
                currentAppHash = data.appHash;
                
                document.getElementById('currentHash').textContent = data.appHash;
                document.getElementById('lastCheck').textContent = new Date().toLocaleTimeString();
                document.getElementById('status').textContent = '–ê–∫—Ç–∏–≤–Ω–æ';
                
                log(`–¢–µ–∫—É—â–∏–π —Ö–µ—à: ${data.appHash}`, 'info');
                return data.appHash;
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ö–µ—à–∞: ${error.message}`, 'error');
                return null;
            }
        }
        
        async function triggerUpdate() {
            try {
                log('üß™ –°–∏–º—É–ª—è—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ —Ö–µ—à–∞...', 'warning');
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Ö–µ—à
                const response = await fetch('/api/version?test=notification');
                const data = await response.json();
                
                log(`‚úÖ –ù–æ–≤—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Ö–µ—à —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω: ${data.appHash}`, 'success');
                log('‚è±Ô∏è –û–∂–∏–¥–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (—á–µ—Ä–µ–∑ ~30 —Å–µ–∫—É–Ω–¥)...', 'warning');
                log('üëÄ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ - –æ–Ω–æ –¥–æ–ª–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è', 'info');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                currentAppHash = data.appHash;
                document.getElementById('currentHash').textContent = data.appHash;
                document.getElementById('status').textContent = '–¢–µ—Å—Ç–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ';
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Å–∏–º—É–ª—è—Ü–∏–∏: ${error.message}`, 'error');
            }
        }
        
        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
            log('–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã', 'info');
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            log('üöÄ –°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–ø—É—â–µ–Ω–∞', 'success');
            checkCurrentHash();
            
            // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ö–µ—à–∞
            setInterval(async () => {
                const newHash = await checkCurrentHash();
                if (newHash && newHash !== currentAppHash && currentAppHash) {
                    log(`üîÑ –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ö–µ—à–∞: ${currentAppHash} ‚Üí ${newHash}`, 'warning');
                    log('üì± –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç—å—Å—è!', 'success');
                }
            }, 5000);
        };
    </script>
</body>
</html>