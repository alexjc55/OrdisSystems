# Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ 502 Bad Gateway

## Ð§Ñ‚Ð¾ Ð¾Ð·Ð½Ð°Ñ‡Ð°ÐµÑ‚ Ð¾ÑˆÐ¸Ð±ÐºÐ° 502
502 = Nginx Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒÑÑ Ðº Node.js Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸ÑŽ Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ñƒ 3000

## Ð”Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ° Ð² FastPanel

### 1. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑ Node.js Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
- Ð—Ð°Ð¹Ð´Ð¸Ñ‚Ðµ Ð² FastPanel â†’ **Node.js Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ**
- ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ `edahouse`
- Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ **"Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚"** Ð¸Ð»Ð¸ **"Running"**

**Ð•ÑÐ»Ð¸ ÑÑ‚Ð°Ñ‚ÑƒÑ "ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾":**
- ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ **"Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ"**
- ÐŸÐµÑ€ÐµÐ¹Ð´Ð¸Ñ‚Ðµ Ðº ÑˆÐ°Ð³Ñƒ 2

### 2. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
- ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð½Ð° Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ `edahouse`
- ÐŸÐµÑ€ÐµÐ¹Ð´Ð¸Ñ‚Ðµ Ð²Ð¾ Ð²ÐºÐ»Ð°Ð´ÐºÑƒ **"Ð›Ð¾Ð³Ð¸"**

**Ð˜Ñ‰Ð¸Ñ‚Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ñ‚Ð¸Ð¿Ð°:**
- `Error: Cannot find module`
- `Database connection failed`
- `Port 3000 is already in use`
- `Permission denied`

### 3. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ Ñ‡Ñ‚Ð¾ ÑƒÐºÐ°Ð·Ð°Ð½Ð¾:
- **Ð¡Ñ‚Ð°Ñ€Ñ‚Ð¾Ð²Ñ‹Ð¹ Ñ„Ð°Ð¹Ð»**: `dist/index.js`
- **ÐŸÐ¾Ñ€Ñ‚**: `3000`
- **Ð Ð°Ð±Ð¾Ñ‡Ð°Ñ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ**: `/var/www/edahouse.ordis.co.il`

## Ð§Ð°ÑÑ‚Ñ‹Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ð¸ Ñ€ÐµÑˆÐµÐ½Ð¸Ñ

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° 1: Ð¤Ð°Ð¹Ð» dist/index.js Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½

**ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ‡ÐµÑ€ÐµÐ· SSH:**
```bash
cd /var/www/edahouse.ordis.co.il
ls -la dist/
```

**Ð•ÑÐ»Ð¸ Ð¿Ð°Ð¿ÐºÐ¸ dist/ Ð½ÐµÑ‚:**
```bash
npm run build
```

**Ð•ÑÐ»Ð¸ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° npm Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚:**
```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ñ‡Ñ‚Ð¾ Node.js ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½
node --version
npm --version

# Ð•ÑÐ»Ð¸ Ð½ÐµÑ‚, ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs
```

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° 2: Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð½Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ÑÑ

**ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ .env Ñ„Ð°Ð¹Ð»:**
```bash
cat .env
```

**Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ:**
```
DATABASE_URL=postgresql://edahouse_ord:33V0R1N5qi81paiA@localhost:5432/edahouse_ord
```

**ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº Ð±Ð°Ð·Ðµ:**
```bash
psql -U edahouse_ord -d edahouse_ord -h localhost
```

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° 3: ÐŸÐ¾Ñ€Ñ‚ ÑƒÐ¶Ðµ Ð·Ð°Ð½ÑÑ‚

**ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ñ‡Ñ‚Ð¾ ÑÐ»ÑƒÑˆÐ°ÐµÑ‚ Ð¿Ð¾Ñ€Ñ‚ 3000:**
```bash
sudo netstat -tlnp | grep :3000
```

**Ð•ÑÐ»Ð¸ Ð¿Ð¾Ñ€Ñ‚ Ð·Ð°Ð½ÑÑ‚ Ð´Ñ€ÑƒÐ³Ð¸Ð¼ Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐ¾Ð¼:**
```bash
sudo kill -9 PID_Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐ°
```

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° 4: ÐŸÑ€Ð°Ð²Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°

**ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð²Ð»Ð°Ð´ÐµÐ»ÑŒÑ†Ð° Ñ„Ð°Ð¹Ð»Ð¾Ð²:**
```bash
ls -la /var/www/edahouse.ordis.co.il
```

**Ð˜ÑÐ¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ Ð¿Ñ€Ð°Ð²Ð°:**
```bash
sudo chown -R www-data:www-data /var/www/edahouse.ordis.co.il
sudo chmod -R 755 /var/www/edahouse.ordis.co.il
```

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° 5: ÐžÑ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‚ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸

**ÐŸÐµÑ€ÐµÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð¿Ð°ÐºÐµÑ‚Ñ‹:**
```bash
cd /var/www/edahouse.ordis.co.il
rm -rf node_modules package-lock.json
npm install
npm run build
```

## ÐŸÐ¾ÑˆÐ°Ð³Ð¾Ð²Ð¾Ðµ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ

### Ð¨Ð°Ð³ 1: ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð² FastPanel
- Node.js Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ â†’ edahouse â†’ **ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ**

### Ð¨Ð°Ð³ 2: ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÐµÑÑŒ Ð¿Ð¾ SSH
```bash
ssh Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ@Ð²Ð°Ñˆ-ÑÐµÑ€Ð²ÐµÑ€
cd /var/www/edahouse.ordis.co.il
```

### Ð¨Ð°Ð³ 3: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
```bash
ls -la
# Ð”Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ: package.json, server/, client/, dist/
```

### Ð¨Ð°Ð³ 4: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ñ‡Ñ‚Ð¾ dist/ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚
```bash
ls -la dist/
# Ð”Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ: index.js
```

**Ð•ÑÐ»Ð¸ dist/ Ð½ÐµÑ‚:**
```bash
npm install
npm run build
```

### Ð¨Ð°Ð³ 5: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ .env Ñ„Ð°Ð¹Ð»
```bash
cat .env
```

**Ð•ÑÐ»Ð¸ Ñ„Ð°Ð¹Ð»Ð° Ð½ÐµÑ‚, ÑÐ¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ:**
```bash
cat > .env << 'EOF'
DATABASE_URL=postgresql://edahouse_ord:33V0R1N5qi81paiA@localhost:5432/edahouse_ord
PGHOST=localhost
PGPORT=5432
PGDATABASE=edahouse_ord
PGUSER=edahouse_ord
PGPASSWORD=33V0R1N5qi81paiA
SESSION_SECRET=WAVl58TU5MAzQkQa6w8YTsuFYyyCwIl24D2j5BNsX4reNv1iYPdNQHtog2Y0CYQ39U1HGYYG1cNQhLIGfxPVNg==
PORT=3000
NODE_ENV=production
ENABLE_REGISTRATION=true
ENABLE_GUEST_ORDERS=true
MAX_FILE_SIZE=5242880
UPLOAD_PATH=./uploads
ALLOWED_ORIGINS=https://edahouse.ordis.co.il
STORE_NAME=edahouse
STORE_DESCRIPTION=Food delivery service
EOF
```

### Ð¨Ð°Ð³ 6: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð±Ð°Ð·Ñƒ Ð´Ð°Ð½Ð½Ñ‹Ñ…
```bash
npm run db:push
```

### Ð¨Ð°Ð³ 7: Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ Ð·Ð°Ð¿ÑƒÑÐº Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ
```bash
node dist/index.js
```

**Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð¿Ð¾ÑÐ²Ð¸Ñ‚ÑŒÑÑ:**
```
ðŸŒ± Seeding database...
âœ… Database already contains data, skipping seed
ðŸš€ Server running on port 3000
```

**Ð•ÑÐ»Ð¸ Ð²ÑÐµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚, Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ Ctrl+C**

### Ð¨Ð°Ð³ 8: Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ñ‡ÐµÑ€ÐµÐ· FastPanel
- Ð’ÐµÑ€Ð½Ð¸Ñ‚ÐµÑÑŒ Ð² FastPanel
- Node.js Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ â†’ edahouse â†’ **Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ**

### Ð¨Ð°Ð³ 9: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÐ°Ð¹Ñ‚
ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ: `https://edahouse.ordis.co.il`

## Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ°

### ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Nginx ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
Ð’ FastPanel:
- Ð”Ð¾Ð¼ÐµÐ½Ñ‹ â†’ edahouse.ordis.co.il â†’ **ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸**
- Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ Ñ‡Ñ‚Ð¾ Ð¿Ñ€Ð¾ÐºÑÐ¸ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½ Ð½Ð° `http://localhost:3000`

### ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð»Ð¾Ð³Ð¾Ð² Nginx
```bash
sudo tail -f /var/log/nginx/error.log
```

### ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ñ… Ñ€ÐµÑÑƒÑ€ÑÐ¾Ð²
```bash
# Ð¡Ð²Ð¾Ð±Ð¾Ð´Ð½Ð°Ñ Ð¿Ð°Ð¼ÑÑ‚ÑŒ
free -m

# ÐœÐµÑÑ‚Ð¾ Ð½Ð° Ð´Ð¸ÑÐºÐµ
df -h

# ÐŸÑ€Ð¾Ñ†ÐµÑÑÑ‹ Node.js
ps aux | grep node
```

## Ð•ÑÐ»Ð¸ Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð¿Ð¾Ð¼Ð¾Ð³Ð°ÐµÑ‚

### ÐŸÐ¾Ð»Ð½Ð°Ñ Ð¿ÐµÑ€ÐµÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ°:
```bash
# 1. ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð² FastPanel
# 2. Ð£Ð´Ð°Ð»Ð¸Ñ‚Ðµ Ð²ÑÐµ Ñ„Ð°Ð¹Ð»Ñ‹
cd /var/www/edahouse.ordis.co.il
rm -rf * .*

# 3. Ð—Ð°Ð½Ð¾Ð²Ð¾ ÐºÐ»Ð¾Ð½Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚
git clone https://github.com/alexjc55/Ordis.git .
npm install
npm run build
npm run db:push

# 4. Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð² FastPanel
```

### ÐžÐ±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ Ð² Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÑƒ
ÐŸÑ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ:
- Ð¡ÐºÑ€Ð¸Ð½ÑˆÐ¾Ñ‚ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ 502
- Ð›Ð¾Ð³Ð¸ Ð¸Ð· FastPanel
- Ð’Ñ‹Ð²Ð¾Ð´ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ `node dist/index.js`
- Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ Ñ„Ð°Ð¹Ð»Ð° .env

## ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð´Ð»Ñ Ð±Ñ‹ÑÑ‚Ñ€Ð¾Ð¹ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ¸

```bash
# ÐžÐ´Ð½Ð¾Ð¹ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¾Ð¹ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð²ÑÐµ
cd /var/www/edahouse.ordis.co.il && \
echo "=== Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° ===" && ls -la && \
echo "=== Ð¤Ð°Ð¹Ð» dist/index.js ===" && ls -la dist/ && \
echo "=== Ð¤Ð°Ð¹Ð» .env ===" && cat .env && \
echo "=== Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… ===" && npm run db:push && \
echo "=== Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ Ð·Ð°Ð¿ÑƒÑÐº ===" && timeout 10s node dist/index.js
```

ÐŸÐ¾ÑÐ»Ðµ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ ÑÐ°Ð¹Ñ‚ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¾Ñ‚ÐºÑ€Ñ‹Ð²Ð°Ñ‚ÑŒÑÑ Ð¿Ð¾ Ð°Ð´Ñ€ÐµÑÑƒ https://edahouse.ordis.co.il Ð±ÐµÐ· Ð¾ÑˆÐ¸Ð±Ð¾Ðº!